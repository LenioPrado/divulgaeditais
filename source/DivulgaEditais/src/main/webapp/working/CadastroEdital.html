<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.15.1/jquery.validate.min.js"/></script>
 	<script src="modality.json"></script>
</head>

<body>
	
<h1>Cadastro de Edital</h1>
<script>

$.getJSON('modality.json', function(json) {
	$select = $('#modality');
	$.each(json, function(i, value) {
           $select.append('<option value="' + value.modality_id + '">' + value.acronyms + ' - ' +value.description + '</option>');
        });
    console.log(json);
});

</script>


<form name= "registerNotice" method="post" onSubmit="return validation();" action="javascript:alert('success!');" enctype="multipart/form-data">
    <label> Modalidade</label>
    <select id="modality" name="modality"></select> <br>
    <label> Numero </label>
    <input type="text" name="number" id="number" /> <br>
    <label> Objeto </label>
    <input type="text" name="object" id="object"/> <br>
    <label> Data do Preg√£o</label>
    <input type="date" name="trading_date" id="trading_date" /> <br>
    <label> PDF </label>
   	<input type="file" name="file" id="file" accept=".pdf"/> <br>
	<button type="button" onclick="Upload()">Enter</button>
    <input type="submit" value="Cadastrar" onclick="return submitData();"></input>

</form>
<script>

function submitData(){
       
	var notice = {
			noticeId: 3,
			modality: { modalityId: 1 },
			number: $("#number").val(),
			object: $("#object").val(),
			tradingDate: '2017-01-3',
			url: 'www.uol.com.br'
	}
	
	$.ajax({
	   type: "post",
	   dataType: "json",
	   url: "http://localhost:8080/DivulgaEditais/rest/notice/create",
	   // The key needs to match your method's input parameter (case-sensitive).
	   data: JSON.stringify( notice ),
	   processData: false,
	   contentType: 'application/json',
	   success: function(data){alert('Sucesso:' + data);},
	   failure: function(errMsg) {
	       alert('Erro:' + errMsg);
	   }
	});

function validation() {
  $("form[name='registerNotice']").validate({
            rules: {
                modality: "required",
                number: "required",
                object: "required",
                trading_date: "required",
                //file: "required",
            },

	alert("Submit button clicked!");
    console.log(notice);
    return false;
}

function Upload()
{
    var file = document.getElementById('file');

    if(file.files.length)
    {
        var reader = new FileReader();

        reader.onload = function(e)
        {
        	var fileContent = e.target.result;
        	console.log(fileContent);
            //document.getElementById('outputDiv').innerHTML = e.target.result;
        };

        reader.readAsBinaryString(file.files[0]);
    }
}

</script>
</body>
</html>